{% extends "base.html" %}

{% block title %}Member Dashboard - Zonuko{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 40px auto; padding: 20px;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
        <h1 style="margin: 0 0 10px 0;">‚≠ê Welcome to Your Zonuko Dashboard!</h1>
        <p style="margin: 0; opacity: 0.9;">Hi {{ user.email }}! This is your member area (Staff Access - Development Mode)</p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <!-- Profile Card -->
        <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0; color: #667eea;">üë§ Your Profile</h2>
            {% if parent_profile %}
                <p><strong>Display Name:</strong> {{ parent_profile.display_name|default:"Not set" }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Member Since:</strong> {{ parent_profile.created_at|date:"F d, Y" }}</p>
            {% else %}
                <p>Profile not yet created.</p>
            {% endif %}
        </div>

        <!-- Subscription Card -->
        <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0; color: #667eea;">üí≥ Subscription Status</h2>
            {% if has_subscription %}
                {% if parent_profile.subscription.founding_member %}
                    <div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                        <strong>‚ú® FOUNDING FAMILY MEMBER ‚ú®</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.95;">¬£9.99/month locked for life</p>
                    </div>
                {% endif %}
                {% if parent_profile.subscription.is_in_trial %}
                    <p style="color: #f59e0b; font-weight: bold;">üéâ Free Trial Active</p>
                    <p style="font-size: 14px; color: #666;">{{ parent_profile.subscription.days_until_trial_end }} days remaining in your trial</p>
                    <p style="font-size: 13px; color: #999; margin-top: 10px;">Trial ends: {{ parent_profile.subscription.trial_end|date:"F d, Y" }}</p>
                {% else %}
                    <p style="color: green; font-weight: bold;">‚úì Active Subscription</p>
                    <p style="font-size: 14px; color: #666;">Next billing: {{ parent_profile.subscription.current_period_end|date:"F d, Y" }}</p>
                {% endif %}
                {% if parent_profile.subscription.founding_member %}
                    <p style="font-size: 13px; color: #f59e0b; margin-top: 10px; font-weight: 500;">üí∞ Your rate: ¬£9.99/month forever (regular members pay ¬£14.99)</p>
                {% endif %}
            {% else %}
                <p style="color: orange; font-weight: bold;">‚ö† No Active Subscription</p>
                <p style="font-size: 14px; color: #666;">Start your 7-day free trial to access all content!</p>
                <a href="{% url 'users:start_subscription' %}" style="display: inline-block; background: #667eea; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; margin-top: 10px;">
                    Start Free Trial
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Children Section -->
    <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; color: #667eea;">üë¶üëß Your Children</h2>
            <a href="{% url 'users:add_child' %}" style="display: inline-block; background: #764ba2; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px;">
                + Add a Child
            </a>
        </div>
        {% if children %}
            <div style="display: grid; gap: 15px;">
                {% for child in children %}
                    <div style="border: 2px solid #f0f0f0; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 48px;">{{ child.get_avatar_emoji }}</div>
                            <div>
                                <h3 style="margin: 0 0 5px 0;">{{ child.username }}</h3>
                                <p style="margin: 5px 0; color: #666; font-size: 14px;"><strong>Age Group:</strong> {{ child.get_age_range_display }}</p>
                                {% if child.quiz_completed %}
                                    <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 13px; margin-top: 5px;">
                                        ‚ú® {{ child.learning_style }}
                                    </div>
                                {% else %}
                                    <p style="margin: 5px 0; color: #999; font-size: 13px; font-style: italic;">Quiz not completed yet</p>
                                {% endif %}
                                <p style="margin: 8px 0 0 0; color: #999; font-size: 12px;"><strong>PIN:</strong> ‚óè‚óè‚óè‚óè (hidden for security)</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-direction: column; align-items: flex-end;">
                            <div style="display: flex; gap: 10px;">
                                <a href="{% url 'users:edit_child' child.id %}" style="color: #667eea; text-decoration: none; font-size: 14px;">Edit</a>
                                <a href="{% url 'users:delete_child' child.id %}" style="color: #dc2626; text-decoration: none; font-size: 14px;">Remove</a>
                            </div>
                            {% if child.quiz_completed %}
                                <form method="post" action="{% url 'users:reset_child_quiz' child.id %}" style="margin: 0;">
                                    {% csrf_token %}
                                    <button type="submit" style="background: none; border: none; color: #f59e0b; text-decoration: underline; font-size: 12px; cursor: pointer; padding: 0;">
                                        Reset Quiz
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #666;">No children added yet. Click "+ Add a Child" above to get started!</p>
        {% endif %}
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #dbeafe; border-left: 4px solid #667eea; border-radius: 6px;">
        <strong>üí° Tip:</strong> Each child gets their own login with a 4-digit PIN, personalized recommendations based on their age group, and progress tracking.
    </div>

    <div style="margin-top: 20px; text-align: center;">
        <a href="{% url 'account_logout' %}" style="color: #667eea; text-decoration: none;">Logout</a>
    </div>
</div>
{% endblock %}
